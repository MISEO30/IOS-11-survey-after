<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IOS 실험 후기</title>
<style>
body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    font-family: sans-serif;
    background-color: #f4f4f9; /* 배경 색상 추가 */
}

.container-card {
    background-color: #ffffff;
    border-radius: 10px;
    padding: 30px;
    margin: 20px 0;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    width: 90%;
    max-width: 600px;
    box-sizing: border-box;
}

h1 {
    text-align: center;
    font-size: 2.5em;
    margin-top: 50px;
    color: #2c3e50; /* 제목 색상 변경 */
    font-weight: bold;
}

table.IOS {
    border-collapse: collapse;
    width: 100%;
    margin: 0 auto;
}

.slider2 {
	-webkit-appearance: none;
	width: 100% !important;
	height: 10px;
	background: none;
	outline: none;
	opacity: 0.8;
	-webkit-transition: 0.2s;
	transition: opacity 0.2s;
}

.slider2::-moz-range-track {
	width: 100% !important;
	height: 10px !important;
	cursor: pointer !important;
	background: #3498db !important; /* 슬라이더 색상 변경 */
	border-radius: 2px !important;
	border: 1px solid #2980b9 !important;
}

.slider2::-moz-range-thumb {
	height: 30px !important;
	width: 20px !important;
	border-radius: 5px !important;
	background: #A9A9A9 !important;
	cursor: pointer !important;
	-webkit-appearance: none !important;
	margin-top: -2.5px !important;
}

.slider2::-webkit-slider-runnable-track {
	width: 100% !important;
	height: 10px !important;
	cursor: pointer !important;
	background: #3498db !important; /* 슬라이더 색상 변경 */
	border-radius: 2px !important;
	border: 1px solid #2980b9 !important;
}

.slider2::-webkit-slider-thumb {
	height: 30px !important;
	width: 20px !important;
	border-radius: 5px !important;
	background: #A9A9A9 !important;
	cursor: pointer !important;
	-webkit-appearance: none !important;
	margin-top: -10px !important;
}

.sliderticks {
	display: flex;
	justify-content: space-between;
	padding: 0 10px;
    position: relative;
}

.sliderticks p {
	position: relative;
	display: flex;
	justify-content: center;
	text-align: center;
	width: 2px;
	background: #a3a3a3;
	height: 10px;
	line-height: 40px;
	margin: 0 0 20 0;
}
.submit-button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    background-color: #2980b9; /* 제출 버튼 색상 변경 */
    color: white;
    border: none;
    border-radius: 5px;
    text-align: center;
    transition: background-color 0.3s ease;
}

.submit-button:hover {
    background-color: #3498db; /* 호버 색상 추가 */
}

.slider-labels {
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 5px;
    margin-top: 5px;
}

.slider-labels span {
    font-size: 14px;
    color: #555;
}

.instruction-text {
    width: 100%;
    max-width: 400px;
    margin: 30px auto;
    line-height: 1.6;
    text-align: center;
    color: #444; /* 지시문 색상 변경 */
}

.input-section {
    width: 100%;
    max-width: 400px;
    margin: 20px auto;
    text-align: center;
}

label {
    display: block;
    margin-bottom: 10px;
    font-weight: bold;
    color: #333;
}

#subjectiveResponse, #debateResponse {
    width: 100%;
    height: 100px;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
    resize: vertical;
    opacity: 0.8;
}

</style>
</head>
<body>

<h1>나와 상대방의 관계를 보여주세요.</h1>

<div class="container-card">
    <div class="instruction-text">
        <p><strong>슬라이더를 움직여 '나'와 '상대방'을 나타내는 두 원의 <i>겹치는 정도</i>를 조절해 주세요. 겹치는 부분의 크기는 <i>나와 상대방 사이의 관계</i>가 얼마나 가까운지를 의미합니다.</strong></p>
        <p>슬라이더를 왼쪽으로 옮기면 두 원이 겹치지 않아 둘 사이에 거리가 있는 상태를 나타냅니다.</p>
        <p>슬라이더를 가운데로 옮기면 두 원이 조금 겹쳐 서로 어느 정도 연결된 상태를 나타냅니다.</p>
        <p>슬라이더를 오른쪽으로 옮기면 두 원이 완전히 겹쳐져 매우 깊고 가까운 관계를 나타냅니다.</p>
        <p><strong>슬라이더를 움직여 <i>지금 느끼시는</i> '나'와 '상대방'의 <i>친밀한 정도</i>를 편하게 표시해 주세요.</strong></p>
    </div>

    <table class="IOS">
        <tr>
          <td style="text-align:center">
            <canvas id="IOSscreen" width="400" height="180" style="border:1px solid #d3d3d3;"></canvas>
          </td>
        </tr>
        <tr>
          <td>
            <table style="width:100%; margin: auto;">
              <tr>
                <td>
                  <input type="range" min="1" max="11" value="0" class="slider2" id="Input" step="1" oninput="change();">
                </td>
              </tr>
              <tr>
                <td>
                  <div class="sliderticks">
                    <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p>
                  </div>
                </td>
              </tr>
              <tr>
                <td>
                  <div class="slider-labels">
                    <span>1</span>
                    <span>2</span>
                    <span>3</span>
                    <span>4</span>
                    <span>5</span>
                    <span>6</span>
                    <span>7</span>
                    <span>8</span>
                    <span>9</span>
                    <span>10</span>
                    <span>11</span>
                  </div>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
</div>

<div class="container-card">
    <div class="input-section">
        <label for="participantID">성함:</label>
        <input type="text" id="participantID" name="participantID">
    </div>

    <div class="input-section">
        <label for="subjectiveResponse">1.오늘 대화한 상대방과 추후 대화할 의향이 있으신가요? 의향 여부와 대화 후기를 간략히 적어주세요(2~3줄)</label>
        <textarea id="subjectiveResponse" rows="5" placeholder="오늘 대화에서 속마음은 어땠는지 자유롭게 기술해주세요. 감사합니다."></textarea>
    </div>

    <div class="input-section">
        <label for="debateResponse">오늘 찬반 토론에 대하여 말씀해주세요.<br>(1) 대화 전 찬반에 대한 본래 태도 <br>(2) 찬반에서 부여받은 태도 <br>(3) 대화 후 현재의 솔직한 태도를 말씀해주세요.</label>
        <textarea id="debateResponse" rows="5" placeholder="3가지 모두 기재 부탁드립니다"></textarea>
    </div>

    <div style="text-align: center;">
        <button class="submit-button" onclick="submitScore()">제출하기</button>
        <p style="font-size: 14px; color: #888; margin-top: 10px;">제출에 시간이 걸리니 한번만 누르고 제출 완료 메시지가 뜰때까지 기다려주세요.</p>
        <p style="font-size: 16px; font-weight: bold; color: #555; margin-top: 20px;">오늘도 수고하셨습니다. 실험에 참여해주셔서 감사합니다.</p>
    </div>
</div>

<script>
//Specify circle values relative to canvas size (here: 400x180)
var center = 200;
var horizontal = 90;
var radius = 70;

//Distances between centers in task, where 2.15 means 2.15*radius. Thus, circles are fully separated
var multiplier = [2.15,1.89,1.64,1.45,1.27,0.91,0.73,0.58,0.44,0.33,0.22]

//function change is executed every time the slider is moved (see html)
function change() {
   var c = document.getElementById("IOSscreen");
   var ctx = c.getContext("2d");

   //initiate value that is not defined to have screen initially empty
   var Value = -1;

   //Get value selected in slider
   Input = document.getElementById("Input");
   Value = Input.value;

   distance1 = center-((radius*multiplier[Value-1])/2);
   distance2 = center+((radius*multiplier[Value-1])/2);

   //Update canvas

   //Empty current canvas
   ctx.clearRect(0, 0, c.width, c.height);

   //Draw new pair of circles
   ctx.beginPath();
   ctx.arc(distance1, horizontal, radius, 0, 2 * Math.PI);
   ctx.stroke();
   ctx.beginPath();
   ctx.arc(distance2, horizontal, radius, 0, 2 * Math.PI);
   ctx.stroke();

   //Keep the label in the center of the circle, to not have more overlap
   if (Value == 1) {
      headers = multiplier[0];
   } else if (Value == 2) {
      headers = multiplier[1];
   } else if (Value == 3) {
      headers = multiplier[2];
   } else {
      headers = multiplier[3];
   }

   //Write labels into
   ctx.font = "25px Arial";
   ctx.textAlign = "center";
   ctx.textBaseline = 'middle';
   ctx.fillText("나", center-((radius*headers)/2), horizontal);
   ctx.fillText("상대방", center+((radius*headers)/2), horizontal);

   //Record variable value
   //Include the variable recording HERE. The currently selected value in the slider is saved in the variable "Value"
}

async function submitScore() {
    var scoreValue = document.getElementById("Input").value;
    var participantID = document.getElementById("participantID").value;
    var subjectiveResponse = document.getElementById("subjectiveResponse").value;
    var debateResponse = document.getElementById("debateResponse").value;

    // URL에 참가자 ID와 점수 값을 추가
    // 새롭게 추가된 주관식 응답인 'debateResponse'를 URL에 포함시킵니다.
    var url = 'https://script.google.com/macros/s/AKfycbzsvGmTPUcnVWX2_Ilcqb46TB8LAn_ldEOwXjRraRBtyTtRwwUrCzQoieA7Ct5lm2V1/exec' +
              '?ios11_score=' + scoreValue +
              '&participant_id=' + participantID +
              '&subjective_response=' + encodeURIComponent(subjectiveResponse) +
              '&debate_response=' + encodeURIComponent(debateResponse);

    try {
        const response = await fetch(url, {
            method: 'GET'
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const result = await response.json();
        console.log('Success:', result);
        alert('응답이 성공적으로 제출되었습니다!');
    } catch (error) {
        console.error('Error:', error);
        alert('응답 제출 중 오류가 발생했습니다. 개발자에게 문의하세요.');
    }
}

// 초기 화면을 그리기 위해 페이지 로드 시 change() 함수 호출
window.onload = function() {
    change();
};
</script>
</body>
</html>
